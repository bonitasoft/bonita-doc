= Release notes
:description: This pages describes the main new values, improvements, technical updates and other changes that have been brought to this latest Bonita main version.

== Welcome to our four Bonita applications!

xref:ROOT:bonita-applications-interface-overview.adoc[Those new applications] beautifully replace our good old Bonita Portal, gone for retirement. +
You will find more information in the <<New Bonita Applications>> chapter below. +


[CAUTION]
====
Custom Profiles with a Portal navigation will be automatically converted to _custom applications_ upon Bonita update. +
Therefore, be extra-careful during the Bonita update procedure.
====

== New values added

=== Video: What's new in Bonita {bonitaVersion}

{empty}

video::mZ1D5Bgla4U[youtube, width=640,height=380]

=== Bonita Studio and Bonita UI Designer

==== Bonita Studio Project Composition

Automation projects now use the power of Maven. You can now compose your project of extensions (connectors, Rest API extensions, themes, and actor filters). +

All these extensions, which are technical components, have to be built outside of the Studio with our SDK (_except for Rest API extensions that can still be developed in the Studio_). This will allow the developer to use their preferred tooling. It will also help the industrialization of your project as you will be able to implement tests for each extension making your project more robust. +

As the extensions are developed outside the Studio, they are no longer bound to a specific Bonita project. They can be easily reused in a different project - thus improving your efficiency. xref:ROOT:project-structure.adoc[More information on how Bonita projects are structured]. +

The Studio is stripped of its major coding editor (except for the REST API Extensions), and has now a xref:ROOT:managing-extension-studio.adoc[dedicated view for extensions]. This view is used to get extensions from different sources: 

* From the Bonita marketplace, which contains all the connectors and actor filters made and maintained by Bonitasoft
* From maven repositories (private or public)
* From files (jar or zip)

Bonita Studio becomes more and more accessible to *citizen developers*. Any technical development should be made outside the Studio. +

As connectors are now extensions of a project, their version is not bound to the Bonita Studio version anymore. Therefore, you do not need to update Bonita Studio to migrate a connector or to migrate your connectors when updating Bonita Studio. This will simplify version updates. +

Finally, your sources will be lighter as the dependencies will be pulled by the project. +

==== Project Overview

Understanding all the elements of a Bonita project has never been easier thanks to the *Project Overview*. Accessible from the coolbar, this new page displays all the elements that can be used in a state-of-the-art Bonita project. From this view, you can create, view or edit the different elements. You can also find documentation on the different components. +

==== Studio Organization Editor

In Bonita Studio, the _Organization_ wizard has been reworked into an editor, to improve your experience and your efficiency.

=== Bonita Runtime

==== SSO with OpenID Connect

It is now possible to xref:ROOT:single-sign-on-with-oidc.adoc[configure Bonita to use OpenID Connect (OIDC)] as an authentication mechanism to access your Bonita applications and achieve Single Sign-on with an external OIDC provider. +
The Authorization Code Flow of OpenID Connect is supported to authenticate when accessing Bonita applications as well as the Resource Owner Credentials Grant and Authorization Code Grant of OAuth 2.0 to authenticate when requesting Bonita REST API. +

== Improvements

=== Bonita Studio and Bonita UI Designer

==== Expression type simplification

Bonita 2021.1 introduced a new expression editor. This new expression editor covers the existing editor expression type use cases. +
Therefore, to simplify the expression flow in Bonita Studio, we are removing the following expression types:

* Constant
* Comparison
* Constant
* Parameter
* Variable
* Contract
* Connector Output

If your project is using these expression types, they will be migrated to the new expression editor when you import your project in Bonita Studio 2021.2.

==== "Switch" widget better guidance
The *Switch widget* feature has been improved to guide the user efficiently to avoid incompatible properties mapping that may lead to inconsistent states of widgets.

==== Tab widget possibility to define the selected tab
It is now possible to define the tab that will be selected by default in the _tabs group_ with the new "Selected" field on the tabs.

==== API Variables response Metadata usage
It is now possible to easily bind the metadata of an API variable response (header, status code, and response value) to other variables.

=== Bonita Runtime

==== New Bonita Applications

Bonita Portal is now removed, meaning that:

* Bonita Mobile Portal has been removed
* Custom profiles with Portal navigations are xref:#_custom_profile_navigation_conversion[converted into custom Applications] with default Bonita layout and Bonita theme
* If you had customized Bonita Portal, please note that the Look & Feel files are removed too: you will need to create a theme an apply it to the newly created applications
* The xref:#_process_manager_profile_navigation[Process Manager profile] is temporarily discontinued
* The Analytics page is also temporarilly discontinued

*Mobile Portal removal*

As Bonita User Application can be used on mobile devices thanks to the responsive Bonita layout, the Mobile Portal is no longer needed.

[#_custom_profile_navigation_conversion]
*Custom Profile navigation conversion*

Before 2021.2, you had the possibility to create custom profiles with specific Portal navigation, with menus and pages, to customize users' Bonita Portal experience. Here is an example:

.Pre-2021.2 Custom Profile navigation example
image::images/temp-release-notes-specific/old_profile_navigation.png[Previous Custom Profile Navigation,600]

that looks like:

.Pre-2021.2 Custom Profile example
image::images/temp-release-notes-specific/custom_profile.png[Previous Custom Profile,600]

In Bonita 2021.2, custom profile navigation has been removed, and thus profiles with navigation are automatically converted into custom applications by the xref:ROOT:migrate-from-an-earlier-version-of-bonita.adoc[migration tool].

Here is what it looks like after conversion:

.Custom Profile navigation converted into a custom application
image::images/temp-release-notes-specific/new_app_converted_from_custom_profile.png[Converted Application]

As with any application, you can now modify its details, URL, change its logo, ...

[#_process_manager_profile_navigation]
*Process Manager profile navigation*
As part of the update of Bonita Portal into Bonita Applications, we have not reimplemented the pages for the profile Process Manager, a new documentation page will soon explain how to rebuild and customize the Bonita Administrator Application to handle the process management capabilities.

*Easy upgrade from Community to Subscription*

From this release, xref:ROOT:upgrade-from-community-to-a-subscription-edition.adoc#bonita-platform-upgrade[upgrade from Community to Subscription] is made a lot easier:
all the tricky configuration part is handled automatically by Bonita Runtime at server startup. +
See xref:#_configuration_file_changes[the related changes] done to specific configuration files.

==== Exception reporting
When something goes wrong while executing processes, we now log only the important information. In addition, the root cause of the issue is the first one shown.

Here is a sample of what will now be logged

----
2021-01-11 17:55:25.551 +0100 WARNING (Bonita-Worker-1-01) org.bonitasoft.engine.work.RetryingWorkExecutorService THREAD_ID=115 | HOSTNAME=Baptistes-MBP | TENANT_ID=1 | Work ExecuteFlowNodeWork: flowNodeInstanceId: 60001 (37, false, false, false) failed. The element will be marked as failed. Exception is: java.lang.ArithmeticException: Division by zero
	wrapped by org.bonitasoft.engine.expression.exception.SExpressionEvaluationException: Groovy script throws an exception of type class java.lang.ArithmeticException with message = Division by zero
Expression : SExpressionImpl [name=aScript, content=1/0, returnType=java.lang.String, dependencies=[], expressionKind=ExpressionKind [interpreter=GROOVY, type=TYPE_READ_ONLY_SCRIPT]]
	wrapped by org.bonitasoft.engine.core.process.instance.api.exceptions.SActivityStateExecutionException: error while updating display name and description
 exception was generated here:	at java.math.BigDecimal.divide(BigDecimal.java:1745)
	at org.codehaus.groovy.runtime.typehandling.BigDecimalMath.divideImpl(BigDecimalMath.java:68)
	at org.codehaus.groovy.runtime.typehandling.IntegerMath.divideImpl(IntegerMath.java:49)
----

A new property `bonita.tenant.work.exceptionsNumberOfFrameToLog` in file `bonita-tenant-community-custom.properties` allows the change the number of frames (=lines) displayed when an exception happens.

==== Logging

Default log level for `com.bonitasoft` and `org.bonitasoft` change from `WARNING` to `INFO`.

==== Groovy script results casting

Bonita Runtime will automatically try to cast the result of groovy scripts when it differs from the declared return type if it can be converted. +
For example, when a script returns a long and you have declared `java.lang.Integer` as the return type of your expression, it was throwing an Invalid return type exception. Now it will cast that result to an integer. +
That will make the expression more permissive. +

[NOTE]
====

Groovy is able to cast any object in boolean so scripts that declare a return type `java.lang.Boolean` that failed because of the wrong return type will now always
work and return either `true` or `false`. See https://groovy-lang.org/semantics.html#Groovy-Truth[Official Groovy documentation] for truthy/falsy values.
====

==== JAAS authentication is now Enterprise

JAAS Authentication is now only available in the Enterprise edition. +
In the Community edition, if you are updating from Bonita 2021.1 or an earlier version, you will need to xref:ROOT:bonita-bpm-platform-setup.adoc[change your configuration] file `authenticationManager-config.properties` and remove the JAAS configuration to use another Authentication Manager (an implementation of your own, for instance).


==== 4xx HTTP errors handling
When trying to load an application resource (Javascript, CSS, image...), if there is a 4xx error, like 404 (not found) or 403 (forbidden), the status code is now set in the HTTP response header but Bonita applications no longer try to display the dedicated error pages unless the resource itself is a page (HTML). As a result, the status code remain 4xx and is no longer changed to 200 with the error page in the body of the reponse.

==== LDAP Synchronizer

* LDAP Synchronizer is now available as a Docker image. xref:ROOT:ldap-synchronizer.adoc#_using_the_ldap_synchronizer_docker_image[See the documentation].
* A new property `tenantId` can be set to avoid having to use the Platform Admin credentials. xref:ROOT:ldap-synchronizer.adoc#_bonita_properties[See the documentation].

== Technical updates

=== Java 11 Compliance

Bonita 2021.2 is now only compatible with Java 11. Support with Java 8 has now been removed.

=== Tomcat

Tomcat has been updated to version 9.0.52.

=== Configuration file changes

* The unused configuration file `forms-config.properties` has been removed.
* The optional configuration file `jaas-standard.cfg` has been removed from Tomcat Community bundle (because xref:_jaas_authentication_is_now_enterprise[JAAS is now Enterprise]).
* CAS and Kerberos configuration files have been moved to folder `tools/SSO/` (Bonita Enterprise only).

== Feature deprecations and removals

=== Deprecations

==== API

 - In the TenantAdministrationAPI, the installBusinessDataModel method is now deprecated, as the new method updateBusinessDataModel replaces it for all use cases.
 - The ReportingAPI is now deprecated.

=== Removals

==== BonitaStudioBuilder

The deprecated `BonitaStudioBuilder` command line interface has been removed. To benefit from an efficient Bonita project building and deploying solution, please refer to the https://documentation.bonitasoft.com/bcd[BCD add-on].

==== Import workspace

The import workspace feature has been removed. Use the standard project xref:ROOT:workspaces-and-repositories.adoc#export-import[export/import] or the xref:workspaces-and-repositories.adoc#git[Git integration] instead.

==== Example pages / Rest API extensions

Bonita Tomcat bundle 2021.2 does not include anymore the following example pages / Rest API extensions:

- REST API extension example
- API extension viewer page
- Groovy example page
- HTML example page

If you migrate from an earlier version of Bonita, you can now delete them if you do not use them (previously, they could not be deleted).


== Bug fixes

=== Fixes in Bonita 2021.2-u1

==== Fixes in Bonita Development Suite (Studio and UI Designer)

* STUDIO-4169 - Maven zip dependencies cannot be retrieved from Studio (REST API, Themes)
* STUDIO-4159 - Invalid Search index reference in operations
* STUDIO-4158 - dead lock while building process with LA build command
* STUDIO-4156 - "Initializing portal..." in window when user click on Applications in the Studio
* STUDIO-4148 - Missing DAO and new Object created in the BDM : Expression Editor is not up-to-date
* STUDIO-4135 - Import bos broken if project's name contains accents or quotes
* STUDIO-4122 - Documentation generation fails with decision table
* STUDIO-4118 - Projects are lost by the Studio whereas there are on the disk
* STUDIO-4180 - Update extension fails because an optional value is not present
* STUDIO-4188 - Can't swith to a bonita project anymore after renaming it

==== Fixes in Bonita Runtime (including Administrator app & User app)

* RUNTIME-597 - [Custom API Extension] The redirect mechanism impacts rest api extension response
* RUNTIME-593 - Several dependency issues
* RUNTIME-586 - CORS requests do not work with OIDC for preflight requests
* RUNTIME-563 - The case comments in the task details disappear when a task is completed.
* RUNTIME-542 - Adding a comment when you execute a task with no form on behalf of someone else does not work
* RUNTIME-541 - Process instances started on someones behalf are not displayed as such in the case Details page
* RUNTIME-537 - Execute the task on behalf of someone from new Admin Task Details does not set the executedBySubstitute
* RUNTIME-527 - Case details and Task details does not display 'displayDescription'
* RUNTIME-518 - REST API caseVariable return 500 when p greater than number results in database
* RUNTIME-473 - generateRequestKey script and Bonita Tomcat are not bound to use the very same 'java' binary
* RUNTIME-472 - Redirection after User login gets 403

=== Fixes in Bonita 2021.2

==== Fixes in Studio and UI Designer

* UID-459 - BO variable cannot be edited in fragment after workspace import from previous version and error message is wrong

* STUDIO-4126 - Process execution errors: bcd-dependencies:7.11.5 generates a .bar different from Studio 7.11.5
* STUDIO-4113 - Process Validation freezes after process import
* STUDIO-4086 - Expression editor inserts the wrong operator ' =<' instead of '<=' in groovy script
* STUDIO-4066 - java.lang.NullPointerException at build when wrong variable entered in script but not shown in validation
* STUDIO-4043 - errors while importing .bos in studio
* STUDIO-3962 - Release note view is broken on windows
* STUDIO-3953 - LA Builder is slow
* STUDIO-3936 - EMF resources not in synch after using Git operations
* STUDIO-3898 - Model - annotations are positioned relatively to lanes coordinates (not absolute)
* STUDIO-3880 - Editing domain can be null on an opended diagram
* STUDIO-3875 - Issue with "Switch project" function
* STUDIO-3793 - UIPath connector is not working with cloud orchestrator

==== Fixes in Bonita Runtime

* RUNTIME-479 - CVEs in OpenSSL version in Docker images
* RUNTIME-447 - Security vulnerability REST API portal/runreport open to all profiles
* RUNTIME-271 - Archived cases query fails with 'operator does not exist' error when filtering on process name
* RUNTIME-261 - BDM installation failed when a bdm was already installed
* RUNTIME-138 - Entire BDM install history lost when BDM deployment issue
* RUNTIME-132 - [SAML] Getting the default loging page when signing in on a guest app
* RUNTIME-84 - Loading a class with Class.forName can keep references in VirtualClassloader
* RUNTIME-70 - BDM schemas changes are not rolled back after a failed installation of a new BDM over an existing one
* RUNTIME-34 - Install a BDM with an invalid custom query fail silently
* RUNTIME-27 - Services resume failures after the la-deployer detects bdm deployment timeout
* RUNTIME-23 - Installing BDM with a wrong custom query corrupts the BDM database without any rollback option

== Known issues

=== Email connector 

The rich text editor used to edit an email message does not work on Linux since the `libwebkit2gtk-4.0-37` package has been updated to `2.32.0+`. Last known working version of the package is `2.28.1-1`. Linux users can use the plain text editor or a script expression to edit their email's message body.

=== Document converter connector

[IMPORTANT]
====
Update to, at least, version _2.2.0_
====

Due to an invalid dependency declaration in the `bonita-runtime-bom`, the following dependency must be explicitly added to the project extensions:

_Group Id_: **org.apache.xmlbeans** + 
_Artifact Id_: **xmlbeans** +
_Version_: **3.0.1** +

Use a xref:ROOT:update-studio.adoc[Target runtime version] greater or equal to `7.13.1` to fix the issue.
