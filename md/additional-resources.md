# Additional resources
Additional resources can be added to a process.  
Those resources are added in the .bar file at build time, and are available at runtime.

## Overview

A process can depend on additional resources at runtime.  
Those additional resources are usually basic files, like a mail template, a property file...  
The main difference between [documents](documents.md) and additional resources is that additional resources are not archived. When a process uses a Bonita document, the value of the document at the end of the case is archived in the database. This is not the case for additional resources.  
Use additional resources when you do not want to archive the content of a file dependency.


## Usage

An additional resource is a configuration artifact: 

 - It is defined on a process
 - It is valued in the configuration for a given [environment](environments.md)
 - It is used through Java API

::: warning
Additional resources are the only configuration artifacts that are **not live-updatable**.   
The definitive value of an additional resource must be present in the .bar file, it is not possible to set it / update it through the Bonita portal / any java API. 
:::

### Add an additional resource on a process

An additional resource is defined at process level.  
To add an additional resource: 

 1. Create a new Diagram
 2. Select the pool
 3. Select the property section **Data**
 4. Select the tab **Additional resources**
 5. Click on the **Add** button, the creation wizard opens. The name of the additional resource is mandatory, the description is optional. 
 
 The name of an additional resource corresponds to the relative path in the .bar file of the additional resource. It means that if you decide to name your additional resource _folder/file.txt_, it will be available in the .bar at _resources/misc/**folder/file.txt**_.

### Configure the value of an additional resource

 1. Ensure that an additional resource has been added on a process
 2. Click on the **Configure** button in the coolbar
 3. Select the tab **Additional resources**
 4. Select your additional resource in the table
 5. Click on the cell in the column _File_, a small button should appear in the cell. Click on it.
 6. Select a file from your documents assets, import a new one if needed. 
 7. Validate

::: info
**Note:** For Enterprise, Performance, Efficiency, and Teamwork editions only.
:::
The value of an additional resource is specific to a given [environment](environments.md). Do not forget to value your additional resources for each environment you may use.

### Use an additional resource at runtime

Additional resources are stored in the .bar file, at the following location : 

    /resources/misc/[ADDITIONAL RESOURCE NAME]

Those resources can be retrieved at runtime from any Groovy script, using the Process API:

``` groovy
def Map<String, byte[]> retrieveResources(apiAccessor, processDefinitionId, filenamesPattern) {
	apiAccessor.processAPI.getProcessResources(processDefinitionId, 'resources/misc/filenamesPattern')
}
```
The process API take a _pattern_ in input, and returns a map with all the results. It means that if you want to retrieve all the .txt files, you can use _.txt_ as pattern. If you only want to retrieve one file, use _myFile.txt_ as pattern.  
⚠️ Retrieving to many files can lead to performance issues.  
ℹ️ You can type _bar_ and trigger the autocomplete in any Bonita groovy editor to get the template of the API call to perform.

## Example

We are going to use an additional ressource as an email template, which will be filled with some data from the case.

::: info
**Note**: This tutorial assumes that you already have some Bonita development experience.
:::

 1. On your file system, create the following file:
	   - **Name**: template.txt
	   - **Content**: Hello $name !!!
 
 2. On Bonita Studio, create a new diagram.  Select the pool, and add the following elements: 
	   - An additional ressource named **template**
	   - A process variable **name** (_TEXT_)
	   - A process variable **email** (_TEXT_)
	   - A process variable **emailContent** (_TEXT_)
 
 3. Click on the configuration button, and set the value of the additional ressource **template** with the file you created on step 1.
 4. Add a contract on the pool, with the following contract inputs:
	  - **name** (_TEXT_)
	  - **email** (_TEXT_)
 
 5. Create a form for this contract (using the UIDesigner Studio shortcut).
 _You can skip this step and use the autogenerated form if you want to, it's not important in a devlopment environment._
 
 6. Initialize the  process variable **name** with the contract input **name**, and the process variable **email** with the contract input **email**.
 7. Create a first automated task _fill template and send email_. It will be the only task of the process, add an end event after this task.
 8. Add an operation on this task: 
	  - **Left operand**: process variable _emailContent_
	  -  **Operation**: _Takes value of_
	  - **Right operand**: The following groovy script (**name**: _fillTemplate_, **Return type**: _String_): 

```groovy
// Retrieve the additional resource 'template'
def additionalResources = apiAccessor.processAPI.getProcessResources(processDefinitionId, 'resources/misc/template')

// We expect a small text file -> create a String from its content
def  content = new String(additionalResources.get("resources/misc/template"))

// We are going to fill this template using Groovy template engine, by simply appling a binding map to a String template
def binding = ["name":name] // The key name will be valued with the content of the process variable name.
def engine = new groovy.text.SimpleTemplateEngine()
def  groovyTemplate = engine.createTemplate(content).make(binding)

// Return the value of the filled template -> The $name has been replaced by the content of the process variable name
groovyTemplate.toString() 
```

 9.  On the same automated task, add an ON_FINISH connector email (connector out) with the following configuration:
_We are going to use the free smtp server provided by Google. To use it, you must have a Gmail account, and activate the less secure apps parameter [https://myaccount.google.com/lesssecureapps](https://myaccount.google.com/lesssecureapps)._  
	  - **name**: myConnectorEmail
	  - **SMTP host**: smtp.gmail.com
	  - **SMTP port**: 465
	  - **Username and Password**: Your Gmail credentials
	  - **From**: Your email (the one used above)
	  - **To**: process variable _email_
	  - **Subject**: Hello
	  - **Message**: process variable _emailContent_ (You might need to click on **_switch editor..._** to be able to use the process variable)
	  
 10. Test your process ->  An email should be sent to the email filled in the contract. The content of the email should contain the name filled in the contract.
