<h1>Access business data from a custom page</h1>
<h2>Overview</h2>
<p>The aim of this tutorial is to show how to benefit from the two technologies <strong>Custom pages</strong> and <strong>BDM</strong>.<br>
It will describe how to display Business Data inside a Custom page.</p>
<p><strong>Note:</strong> This information applies to custom pages created manually.
If you <a href="create-or-modify-a-page.md">create a page using the UI designer</a>, access business data using the <a href="bdm-api.md">REST BDM API</a>.</p>
<h2>Pre-requisites</h2>
<p>Before getting to the main part of this tutorial, you will need to carry out the following steps:</p>
<ol>
<li>Create a <a href="define-and-deploy-the-bdm.md">Business Data Management model</a> in Bonita BPM Studio.</li>
<li>Export and deploy a <a href="define-and-deploy-the-bdm.md">Business Data Management model</a>.</li>
<li>Define a groovy custom page. See <a href="pages.md">Custom pages</a>.</li>
<li>Add a custom page to Bonita BPM Portal (as an Administrator). See <a href="custom-profiles.md">Custom profiles</a> and <a href="pages.md">Custom pages</a>.</li>
</ol>
<h2>Main steps</h2>
<h3>Import the Business Data Model</h3>
<p>The Custom Page needs to access the BDM through <strong>.jar files</strong> created by the Bonita BPM Studio during BDM development.</p>
<ol>
<li>Extract the <code>client-bdm.zip</code> file located in the following directory: <code>engine-server/work/tenants/&lt;tenant id&gt;/data-management-client</code></li>
<li>Copy the <code>bdm-dao.jar</code> and <code>bdm-model.jar</code> files that you extracted from the zip into the **custom page directory **called <strong>lib</strong>.
<code>bonita_home\client\tenants\1\work\pages\custompage_yourname\lib</code></li>
</ol>
<p>Note: A new folder containing the custom page is automatically created when the custom page is added.</p>
<h3>Access the Business Data Model</h3>
<p>Suppose we have built a Business Data Model that represents a Leave request process, where the Bonita BPM Studio process stores information about a Leave request.</p>
<p>In the <code>Index.groovy page</code> we have to import the two java classes representing our BDM (in our example Leave request Item and Leave Request ItemDAO), together with the BusinessObjectDAOFactory that will provide us with the DAO objects
<code>import com.bonitasoft.engine.bdm.BusinessObjectDAOFactory</code>
<code>import com.leaverequest.survey.leaverequestItemDAO</code>
<code>import com.myCorp.survey.leaverequestItem</code></p>
<p>Now in the body of the custom page, its's possible to use these classes and their methods:</p>
<p>//Get the apiSession from the context
<code>def apiSession=pageContext.getApiSession();</code></p>
<p>//Create a DAO factory
<code>def BusinessObjectDAOFactory daoFactory = new BusinessObjectDAOFactory();</code></p>
<p>//Use the factory to obtain a DAO object
<code>def LeaveRequestDAO dao = daoFactory.createDAO(apiSession, LeaveRequestDAO.class);</code></p>
<p>//Use methods on DAO object to access data from the BDM. You can pass input values pre-calculated to the method
<code>def List&lt;LeaveRequest&gt; leaveRequestList = dao.find(0,10);</code></p>
<h3>Display your data</h3>
<p>All the data you need to display is in string format, apart from the start and end date, that you should format. For example:
<code>DateFormat df = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;);</code></p>
<p>Now that you got your Business Objects you can display them on your page.
There are many ways to do that with standard .html, depending on your needs.</p>
<p>For example you can use the method <code>out.println()</code>to print html in the page:</p>
<pre><code class="language-groovy">out.println('&lt;table class=&quot;gridtable&quot;&gt;&lt;caption&gt;Leave Request List&lt;/caption&gt;&lt;tr&gt;&lt;th&gt;Start Date &lt;/th&gt;&lt;th&gt;End date&lt;/th&gt;&lt;th&gt;Leave Type&lt;/th&gt;&lt;/tr&gt;');
                        
                        for(LeaveRequest leaveRequest: leaveRequestList){         
                                out.println(&quot;&lt;tr&gt;&lt;td&gt;&quot; + df.format(leaveRequest.getStartDate())+&quot; &lt;/td&gt;&lt;td&gt; &quot; + df.format(leaveRequest.getEndDate())+&quot; &lt;/td&gt;&lt;td&gt; &quot; +leaveRequest.getLeaveType() + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;); 
                        }
                        
                        out.println(&quot;&lt;/table&gt;&quot;);
</code></pre>
<h3>Notes</h3>
<ol>
<li>
<p>When you are developing your custom page, be aware that if you accidentally stop the Bonita BPM Studio, by default this will erase the tenant filesystem and database, so you'd lose your work.<br>
A good idea is to prevent database deletion on the Bonita BPM Studio, Go to Preferences &gt; database and uncheck clean database on exit.</p>
</li>
<li>
<p>If the custom page is not trivial, it's often a good idea to use a groovy IDE to develop it, so it's possible to use auto completion, syntax check and colored text features.<br>
For example if you use Eclipse, you can install the Groovy plugin. Then create a new groovy project and point to the custom page filesystem.</p>
</li>
</ol>
<p>Additionally, you need to configure the build path adding these bonita jars: <code>Bonita-client-sp-6.x.jar</code> and <code>console-server-6.x.jar</code>
And these data models: <code>bdm-dao.jar</code> and <code>bdm-model.jar</code></p>
<ol start="3">
<li>A frequent use case is to refresh the content of the page, re-submitting the queries towards the DAO, via a submit button for example.</li>
</ol>
<p>To do that, one approach is to create a form with a submit button inside, as in the following examples:
<code>out.println(&quot;&lt;form name='myform' id='myform' action=&quot;+actionUrl+&quot;&gt;&quot;);</code>
<code>out.println(&quot;&lt;input type='text' id='name'&gt;&lt;/input&gt;&quot;);</code>
<code>out.println(&quot;&lt;button id='myButton'&gt;Submit&lt;/button&gt;&lt;/form&gt;&quot;)</code></p>
<ol start="4">
<li>
<p>The action of the form (actionUrl in the example) should point to the same url as the Custom page, i.e.
<code>http://localhost:8090/bonita/portal/homepage?tenant=1#?_p=custompage_name&amp;_pf=4)</code></p>
</li>
<li>
<p>By clicking on the submit button, the url will be called and the input parameters will be sent, so the next time the page will be loaded it will have this information.</p>
</li>
</ol>
