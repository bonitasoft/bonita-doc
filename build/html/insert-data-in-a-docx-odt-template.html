<h1>Insert data in a .docx/.odt template</h1>
<p>The <strong>insert data in a .docx/.odt template connector</strong> allows to fill a specified template file by inserting values coming from the current process instance, for example from a form attached to a human task.</p>
<p>The template is a LibreOffice/OpenOffice <code>.odt</code> file or a Microsoft Word<code>.docx</code> file with special placeholders called <code>keys</code>.<br>
A key is a replaceable element in the template that is identified with a dollar sign and surrounded by braces, (eg. ${element}), following the <a href="https://velocity.apache.org/engine/releases/velocity-1.7/user-guide.html">Velocity Template Language</a>.</p>
<p>To configure the connector for a task, add a connector (in or out) to the task, choose the &quot;Office&quot; category, and select &quot;insert data in a .dox/odt template&quot;.</p>
<p>In the connector configuration, the keys are mapped to variables from the process or from any other data source.<br>
At some point in the process instance, the template file must be set as the content of a document created at pool level.<br>
When the connector runs, it creates a file based on the template and inserts the current values of the relevant variables into the appropriate placeholders (keys) in the file.<br>
The generated file can replace the template in the same document or be stored in another document of the process. A common usage is to send the document by email or store it in an external information system using another connector.</p>
<h2>How to insert <code>keys</code> in a template file</h2>
<h3>Using Word (docx) - Tested versions are <strong>Microsoft Word 2007/2010</strong>, may work on later versions</h3>
<h4>Create a <code>field</code></h4>
<ul>
<li>Insertion &gt; QuickPart &gt; Field...</li>
<li>Select FusionField (or MergeField in some Word versions) and use a template (see Velocity templating language) as field name (eg: ${name}, ${user.Name}...etc)</li>
<li>Click OK</li>
</ul>
<h4>Updating an existing <code>key</code></h4>
<ul>
<li>Right click on the Fusionfield to edit</li>
<li>Click on Update field...</li>
</ul>
<h3>Using LibreOffice (odt)</h3>
<ul>
<li>Insert &gt; Fields &gt; More fields...</li>
<li>Go to Variables tab, select UserField and use a template (see Velocity templating language) as value (eg: ${name}, ${user.Name}...etc)</li>
<li>Choose Text format</li>
<li>Click Insert<br>
For further information about the template design, <a href="https://code.google.com/p/xdocreport/wiki/DesignReport">click here</a>
<strong>Warning:</strong> there is a known issue when adding an image in a .docx using drag'n'drop instead of a copy/paste. The image is not rendered properly if you convert the generated file into PDF.</li>
</ul>
<h2>Example of template using key values taken from a business variable</h2>
<h3>Business Data model used in the example</h3>
<p>Here is a <a href="images/special_code/study-leave-template.docx">template example</a> for Leave Request submission and approval.<br>
This .docx file uses keys, most of which will be replaced by values from business variables created from the following <strong>Business Data Model</strong>:</p>
<p><img src="images/7.3/images-6_0/MyUser_Model_lazy.png" alt=""></p>
<p><img src="images/7.3/images-6_0/Address_Model.png" alt=""></p>
<p><img src="images/7.3/images-6_0/StudyLeave_Model.png" alt=""></p>
<h3>Connector configuration</h3>
<p>The configuration is as follows:</p>
<p><img src="images/7.3/images-6_0/document_templating_input_mappings.png" alt=""></p>
<p>In this example, the key named <code>user</code> is mapped to the business variable <code>user</code>, the key named <code>leave</code> is mapped to the business variable <code>studyLeave</code>, and the key named <code>today</code> is mapped to a groovy script expression with the following content:</p>
<pre><code class="language-groovy">        import java.text.SimpleDateFormat;
        new SimpleDateFormat(&quot;yyyy/MM/dd&quot;).format(new Date())
</code></pre>
<ul>
<li>If the keys are mapped with complex objects, pass the high level object to the mapping (eg. <strong>'user'</strong>). The connector will handle the sub-structure of this complex object (eg. <strong>${user.firstName}</strong>)</li>
<li>When using business variables, relations &quot;loaded when needed&quot; (lazy mode) are not loaded in a connector execution context. To use such relations, create new keys, like &quot;userAddress&quot; in the above example.</li>
<li>If the replacement value is null, then the field key will be rendered (eg. <strong>${userAddress.line2}</strong>). Use a &quot;!&quot; mark to render blank value, like <strong>$!{userAddress.line2}</strong> if userAddress.line2 may be null.</li>
</ul>
<p>And the output file mapping:</p>
<p><img src="images/7.3/images-6_0/document_templating_outputs.png" alt=""></p>
<p>In this business example, the requesting user enters personal information in a process form. In a subsequent step, the reviewing user adds Approval information. The entered values are then provided as inputs to the <strong>insert data in a .docx/.odt template connector</strong> to replace the keys.<br>
The generated output file is then stored in a document of the process.<br>
This connector is built upon <strong>XdocReport</strong> third party library, for more information check their Wiki at <a href="https://github.com/opensagres/xdocreport/wiki">https://github.com/opensagres/xdocreport/wiki</a><br>
You will find out advanced report design documentation:</p>
<ul>
<li><a href="https://github.com/opensagres/xdocreport/wiki/DocxReportingJavaMainListFieldAdvancedTable">Loop for keys in table rows</a></li>
<li><a href="https://github.com/opensagres/xdocreport/wiki/DocxDesignReportMacro">Use a MS Word macro to design the report</a></li>
<li><a href="https://github.com/opensagres/xdocreport.samples">Report samples</a></li>
<li>...</li>
</ul>
